# ============================================
# Core service configuration
# ============================================

# OpenAI API key (required)
OPENAI_API_KEY=your-openai-key-here

# API key for /update_index endpoint
UPDATE_API_KEY=your-update-key-here

# Environment: production | development
ENV=production

# Log level: DEBUG | INFO | WARNING | ERROR
LOG_LEVEL=INFO

# Comma-separated list of allowed origins for CORS
# Example: https://app.example.com,https://admin.example.com
CORS_ORIGINS=

# ============================================
# OpenAI / LangChain timeouts & retries
# ============================================

# Generic OpenAI timeout (seconds) for embeddings
OPENAI_TIMEOUT=30

# Timeout for Chat LLM calls (seconds)
OPENAI_LLM_TIMEOUT=120

# Timeout for batch operations (index building) in seconds
OPENAI_BATCH_TIMEOUT=300

# Max number of retries for OpenAI calls
OPENAI_MAX_RETRIES=3

# Exponential backoff base for retries (e.g., 1.5 → 0s, 1.5s, 2.25s…)
OPENAI_RETRY_BACKOFF_BASE=1.5

# ============================================
# Prompt / RAG behavior
# ============================================

# Language for responses (ru|en)
PROMPT_LANGUAGE=ru

# Base URL for documentation links
PROMPT_BASE_DOCS_URL=https://docs.aqtra.io/

# Message when information is not found
PROMPT_NOT_FOUND_MESSAGE=Информация не найдена в базе документации.

# Include sources list in response text (true|false)
PROMPT_INCLUDE_SOURCES_IN_TEXT=true

# Mode: strict (strictly documentation-based) or helpful (more conversational, still grounded)
PROMPT_MODE=strict

# Default temperature for LLM (0.0–1.0)
# Recommended: 0.1 for strict, 0.2 for helpful
PROMPT_DEFAULT_TEMPERATURE=0.1

# Default number of chunks to retrieve (1–10)
# Recommended: 4 for strict, 5–6 for helpful
PROMPT_DEFAULT_TOP_K=4

# Default max tokens for LLM answers (128–4096)
# Recommended: 800 for strict, 1200 for helpful
PROMPT_DEFAULT_MAX_TOKENS=800

# ============================================
# Chunking configuration (balanced defaults)
# ============================================

# Target chunk size in characters
CHUNK_SIZE=1500

# Overlap between chunks in characters
CHUNK_OVERLAP=300

# Minimum chunk size; smaller chunks are discarded
MIN_CHUNK_SIZE=200

# ============================================
# Reranking / Retrieval tuning
# ============================================

# Enable LLM-based reranking (ContextualCompressionRetriever)
# 0 / false → disabled (faster, cheaper)
# 1 / true  → enabled (better quality, more expensive)
RERANKING_ENABLED=0

# ============================================
# Cache configuration
# ============================================

# TTL for cached /query responses in seconds
CACHE_TTL_SECONDS=600

# Max number of cached entries
CACHE_MAX_SIZE=500

# ============================================
# Rate limiting
# ============================================

# /query: max N requests per window (per IP)
QUERY_RATE_LIMIT=30
QUERY_RATE_WINDOW_SECONDS=60

# /update_index: max N requests per window (per API key/IP)
UPDATE_RATE_LIMIT=3
UPDATE_RATE_WINDOW_SECONDS=3600

# /escalate: max N escalation requests per window (per IP)
ESCALATE_RATE_LIMIT=5
ESCALATE_RATE_WINDOW_SECONDS=3600

# ============================================
# Database (Postgres) for logging / analytics
# ============================================

# Example: postgresql+asyncpg://user:password@host:5432/dbname
DATABASE_URL=

# Salt used for hashing IP addresses in logs (do NOT leave default in production)
IP_HASH_SALT=CHANGE_ME

# ============================================
# Zoho Desk integration (escalations)
# ============================================

# Zoho Accounts base URL (depends on region)
ZOHO_ACCOUNTS_BASE_URL=https://accounts.zoho.eu

# Zoho Desk base URL (depends on region)
ZOHO_DESK_BASE_URL=https://desk.zoho.eu

# OAuth client credentials (from Zoho)
ZOHO_CLIENT_ID=
ZOHO_CLIENT_SECRET=
ZOHO_REFRESH_TOKEN=

# Zoho Desk organization and department IDs
ZOHO_DESK_ORG_ID=
ZOHO_DESK_DEPARTMENT_ID=