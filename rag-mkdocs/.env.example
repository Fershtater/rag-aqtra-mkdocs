# ============================================================================
# Aqtra RAG Service - Environment Configuration Template
# ============================================================================
# Copy this file to .env and fill in your values.
# Never commit .env to version control (it's in .gitignore).
# ============================================================================

# --- General ---
# Environment mode: "development" or "production"
# In production, unsafe FAISS deserialization is disabled
ENV=development

# Logging level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# --- Security / API Keys ---
# Comma-separated API keys for /api/answer, /stream, /api/prompt/render
# If not set, endpoints are open (no authentication required)
# Example: RAG_API_KEYS=key1,key2,key3
RAG_API_KEYS=

# API key for /update_index endpoint (required if using /update_index)
UPDATE_API_KEY=change-me

# --- OpenAI / LLM ---
# Required: OpenAI API key for embeddings and LLM
OPENAI_API_KEY=change-me

# OpenAI API timeout in seconds (default: 30)
OPENAI_TIMEOUT=30

# OpenAI LLM timeout in seconds (default: 120)
OPENAI_LLM_TIMEOUT=120

# OpenAI batch operations timeout in seconds (default: 300)
OPENAI_BATCH_TIMEOUT=300

# OpenAI max retries (default: 3)
OPENAI_MAX_RETRIES=3

# OpenAI retry backoff base (default: 1.5)
OPENAI_RETRY_BACKOFF_BASE=1.5

# --- Documentation & Vectorstore ---
# Path to documentation directory (default: data/mkdocs_docs)
DOCS_PATH=data/mkdocs_docs

# Directory for FAISS vectorstore index (default: var/vectorstore/faiss_index)
# This directory is created at runtime and should NOT be committed to git
VECTORSTORE_DIR=var/vectorstore/faiss_index

# --- Chunking ---
# Document chunk size in characters (default: 1500)
CHUNK_SIZE=1500

# Document chunk overlap in characters (default: 300)
CHUNK_OVERLAP=300

# Minimum chunk size in characters (default: 200)
MIN_CHUNK_SIZE=200

# --- Prompt Templating ---
# Template mode: "legacy" (hardcoded) or "jinja" (Jinja2 templates)
PROMPT_TEMPLATE_MODE=legacy

# Prompt preset: "strict", "support", or "developer" (used if PROMPT_TEMPLATE_MODE=jinja)
PROMPT_PRESET=strict

# Directory for prompt templates (default: app/prompts)
PROMPT_DIR=app/prompts

# Path to custom Jinja2 template file (optional, overrides preset)
# PROMPT_TEMPLATE_PATH=custom/path.j2

# Inline Jinja2 template string (optional, highest priority)
# PROMPT_TEMPLATE={{ custom template }}

# Validate template on startup (default: true)
PROMPT_VALIDATE_ON_STARTUP=1

# Fail hard on template errors (default: false)
PROMPT_FAIL_HARD=0

# Strict undefined variables in Jinja2 (default: true)
PROMPT_STRICT_UNDEFINED=1

# Maximum characters in rendered prompt (default: 40000)
PROMPT_MAX_CHARS=40000

# Log rendered prompts (default: false, set to 0 in production)
PROMPT_LOG_RENDERED=0

# --- Prompt Behavior ---
# Comma-separated list of supported languages (default: en,de,fr,es,pt)
PROMPT_SUPPORTED_LANGUAGES=en,de,fr,es,pt

# Fallback language when user's language is not supported (default: en)
PROMPT_FALLBACK_LANGUAGE=en

# Base URL for documentation links (default: https://docs.aqtra.io/)
PROMPT_BASE_DOCS_URL=https://docs.aqtra.io/

# Message when information is not found (default: Information not found...)
PROMPT_NOT_FOUND_MESSAGE=Information not found in documentation database.

# Include sources list in response text (default: true)
PROMPT_INCLUDE_SOURCES_IN_TEXT=true

# Prompt mode: "strict" (documentation-based) or "helpful" (more conversational)
PROMPT_MODE=strict

# Default LLM temperature (0.0-1.0, default: 0.0)
PROMPT_DEFAULT_TEMPERATURE=0.0

# Default top K for retrieval (1-10, default: 4)
PROMPT_DEFAULT_TOP_K=4

# Default max tokens for LLM answers (128-4096, default: 1200)
PROMPT_DEFAULT_MAX_TOKENS=1200

# --- RAG Behavior ---
# Enable short-circuit in strict mode when no relevant sources (default: true)
STRICT_SHORT_CIRCUIT=1

# Score threshold for 'not found' detection (0.0-1.0, default: 0.20)
NOT_FOUND_SCORE_THRESHOLD=0.20

# Enable LLM-based reranking (default: false, adds cost/latency)
RERANKING_ENABLED=0

# --- Cache ---
# Cache TTL in seconds (default: 600 = 10 minutes)
CACHE_TTL_SECONDS=600

# Maximum cache size (default: 500)
CACHE_MAX_SIZE=500

# --- Rate Limiting ---
# Query rate limit per window (default: 30)
QUERY_RATE_LIMIT=30

# Query rate limit window in seconds (default: 60)
QUERY_RATE_WINDOW_SECONDS=60

# Update index rate limit per window (default: 3)
UPDATE_RATE_LIMIT=3

# Update index rate limit window in seconds (default: 3600 = 1 hour)
UPDATE_RATE_WINDOW_SECONDS=3600

# Escalate rate limit per window (default: 5)
ESCALATE_RATE_LIMIT=5

# Escalate rate limit window in seconds (default: 3600 = 1 hour)
ESCALATE_RATE_WINDOW_SECONDS=3600

# --- Index Management ---
# Index lock timeout in seconds (default: 300 = 5 minutes)
INDEX_LOCK_TIMEOUT_SECONDS=300

# --- Database (Optional) ---
# Database connection URL for analytics logging
# Example: postgresql+asyncpg://user:pass@host:5432/dbname
# DATABASE_URL=

# --- Zoho Desk (Optional) ---
# Zoho Desk OAuth credentials for /escalate endpoint
# Requires DATABASE_URL to be set
# ZOHO_CLIENT_ID=
# ZOHO_CLIENT_SECRET=
# ZOHO_REFRESH_TOKEN=
# ZOHO_ORG_ID=
